<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Your Seats - EasyTravel</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header class="header">
        <nav class="nav container">
            <a href="../index.html" class="logo">
                <img src="../assets/images/logo.png" alt="EasyTravel Logo">
                <span>EasyTravel</span>
            </a>
        </nav>
    </header>

    <main class="seat-selection-page">
        <div class="container">
            <div class="booking-header">
                <h1>Select Your Seats</h1>
                <div class="trip-details">
                    <div class="bus-info">
                        <h2 class="bus-name">General Express</h2>
                        <p class="route">Bamenda → Douala</p>
                        <p class="departure">Departure: <span>06:30 AM</span></p>
                        <div class="driver-info"></div>
                    </div>
                    <div class="date-info">
                        <p class="date">January 4, 2025</p>
                        <p class="duration">Duration: 5h</p>
                    </div>
                </div>
            </div>

            <div class="seat-selection-container">
                <div class="seat-map">
                    <div class="bus-layout">
                        <div class="driver-section">
                            <i class="fas fa-steering-wheel"></i>
                            <span>Driver</span>
                        </div>
                        <div class="seats-grid">
                            <!-- Seats will be dynamically generated here -->
                        </div>
                    </div>
                    <div class="seat-legend">
                        <div class="legend-item">
                            <div class="seat-demo available"></div>
                            <span>Available</span>
                        </div>
                        <div class="legend-item">
                            <div class="seat-demo selected"></div>
                            <span>Selected</span>
                        </div>
                        <div class="legend-item">
                            <div class="seat-demo occupied"></div>
                            <span>Occupied</span>
                        </div>
                    </div>
                </div>

                <div class="booking-summary">
                    <h3>Booking Summary</h3>
                    <div class="summary-details">
                        <div class="summary-item">
                            <span>Selected Seats:</span>
                            <span id="selectedSeatsDisplay">None</span>
                        </div>
                        <div class="summary-item">
                            <span>Price per seat:</span>
                            <span id="pricePerSeat">20,000 FCFA</span>
                        </div>
                        <div class="summary-item total">
                            <span>Total Amount:</span>
                            <span id="totalAmount">0 FCFA</span>
                        </div>
                    </div>
                    <div class="passenger-form"></div>
                    <button id="proceedToPayment" class="proceed-btn" disabled>
                        Proceed to Payment
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get bus details from URL
            const urlParams = new URLSearchParams(window.location.search);
            const busName = urlParams.get('bus');
            
            // Sample bus data (in real app, this would come from backend)
            const busData = {
                'General Express': {
                    driver: {
                        name: 'Mr. John Ndi',
                        experience: '15 years',
                        rating: 4.9
                    },
                    seatTypes: {
                        window: 22000,
                        aisle: 20000,
                        front: 23000
                    }
                },
                'Bucavoyages': {
                    driver: {
                        name: 'Mr. Peter Fon',
                        experience: '12 years',
                        rating: 4.8
                    },
                    seatTypes: {
                        window: 17000,
                        aisle: 15000,
                        front: 18000
                    }
                },
                'Blue Bird': {
                    driver: {
                        name: 'Mr. James Taku',
                        experience: '8 years',
                        rating: 4.6
                    },
                    seatTypes: {
                        window: 9000,
                        aisle: 8000,
                        front: 10000
                    }
                },
                'Moghamo Express': {
                    driver: {
                        name: 'Mr. Robert Ngwa',
                        experience: '10 years',
                        rating: 4.7
                    },
                    seatTypes: {
                        window: 6000,
                        aisle: 5000,
                        front: 7000
                    }
                }
            };

            const currentBus = busData[busName];
            
            // Update bus info
            document.querySelector('.bus-name').textContent = busName;
            document.querySelector('.driver-info').innerHTML = `
                <p><strong>Driver:</strong> ${currentBus.driver.name}</p>
                <p><strong>Experience:</strong> ${currentBus.driver.experience}</p>
                <p><strong>Rating:</strong> ${currentBus.driver.rating}⭐</p>
            `;

            const seatsGrid = document.querySelector('.seats-grid');
            const selectedSeatsDisplay = document.getElementById('selectedSeatsDisplay');
            const totalAmountDisplay = document.getElementById('totalAmount');
            const proceedBtn = document.getElementById('proceedToPayment');
            const maxSeats = 4; // Maximum seats that can be selected
            let selectedSeats = [];

            // Generate seats
            const rows = 8;
            const seatsPerRow = 4;
            const occupiedSeats = ['A1', 'B3', 'C4', 'F2']; // Example of pre-occupied seats

            for (let i = 0; i < rows; i++) {
                const row = document.createElement('div');
                row.className = 'seat-row';
                const rowLetter = String.fromCharCode(65 + i);

                for (let j = 0; j < seatsPerRow; j++) {
                    const seatNumber = rowLetter + (j + 1);
                    const seat = document.createElement('div');
                    seat.className = 'seat';
                    seat.dataset.seatNumber = seatNumber;
                    
                    // Determine seat type and price
                    let seatType = '';
                    let seatPrice = 0;
                    
                    if (i < 2) { // First two rows are front seats
                        seatType = 'front';
                        seatPrice = currentBus.seatTypes.front;
                    } else if (j === 0 || j === seatsPerRow - 1) { // Window seats
                        seatType = 'window';
                        seatPrice = currentBus.seatTypes.window;
                    } else { // Aisle seats
                        seatType = 'aisle';
                        seatPrice = currentBus.seatTypes.aisle;
                    }
                    
                    seat.dataset.type = seatType;
                    seat.dataset.price = seatPrice;
                    
                    if (occupiedSeats.includes(seatNumber)) {
                        seat.classList.add('occupied');
                    } else {
                        seat.classList.add('available');
                    }

                    // Add seat number and price
                    seat.innerHTML = `
                        <span class="seat-label">${seatNumber}</span>
                        <span class="seat-type">${seatType}</span>
                        <span class="seat-price">${seatPrice.toLocaleString()} FCFA</span>
                    `;

                    if (!occupiedSeats.includes(seatNumber)) {
                        seat.addEventListener('click', () => toggleSeat(seat, seatNumber, seatPrice));
                    }

                    row.appendChild(seat);
                }
                seatsGrid.appendChild(row);
            }

            function toggleSeat(seat, seatNumber, seatPrice) {
                if (seat.classList.contains('occupied')) return;
                
                if (seat.classList.contains('selected')) {
                    seat.classList.remove('selected');
                    selectedSeats = selectedSeats.filter(s => s.number !== seatNumber);
                } else {
                    if (selectedSeats.length >= maxSeats) {
                        alert(`Maximum ${maxSeats} seats can be selected at once`);
                        return;
                    }
                    seat.classList.add('selected');
                    selectedSeats.push({
                        number: seatNumber,
                        price: seatPrice,
                        type: seat.dataset.type
                    });
                }

                updateSummary();
            }

            function updateSummary() {
                if (selectedSeats.length > 0) {
                    const seatDetails = selectedSeats.map(seat => 
                        `${seat.number} (${seat.type} - ${seat.price.toLocaleString()} FCFA)`
                    ).join(', ');
                    
                    selectedSeatsDisplay.textContent = seatDetails;
                    
                    const total = selectedSeats.reduce((sum, seat) => sum + seat.price, 0);
                    totalAmountDisplay.textContent = `${total.toLocaleString()} FCFA`;
                    proceedBtn.disabled = false;
                } else {
                    selectedSeatsDisplay.textContent = 'None';
                    totalAmountDisplay.textContent = '0 FCFA';
                    proceedBtn.disabled = true;
                }
            }

            // Add passenger information form
            const passengerForm = document.createElement('div');
            passengerForm.className = 'passenger-form';
            passengerForm.innerHTML = `
                <h3>Passenger Information</h3>
                <form id="passengerDetails">
                    <div class="form-group">
                        <label for="fullName">Full Name</label>
                        <input type="text" id="fullName" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email (Optional)</label>
                        <input type="email" id="email">
                    </div>
                </form>
            `;
            
            document.querySelector('.booking-summary').insertBefore(
                passengerForm, 
                document.querySelector('.proceed-btn')
            );

            proceedBtn.addEventListener('click', () => {
                const form = document.getElementById('passengerDetails');
                if (!form.checkValidity()) {
                    alert('Please fill in all required passenger information');
                    return;
                }
                
                // Here we'll add the payment processing logic
                const bookingDetails = {
                    bus: busName,
                    driver: currentBus.driver.name,
                    seats: selectedSeats,
                    passenger: {
                        name: document.getElementById('fullName').value,
                        phone: document.getElementById('phone').value,
                        email: document.getElementById('email').value
                    },
                    total: selectedSeats.reduce((sum, seat) => sum + seat.price, 0)
                };
                
                console.log('Booking Details:', bookingDetails);
                alert('Proceeding to payment...');
            });
        });
    </script>
</body>
</html>
